<div class="animated fadeIn">
  <p-panel #pnl>
    <p-header> Quản lý vai trò </p-header>

    <div class="card">
      <p-toolbar styleClass="p-mb-4">
        <ng-template pTemplate="left">
          <button
            pButton
            pRipple
            label="Thêm"
            icon="pi pi-plus"
            class="p-button-success mr-2"
            (click)="showAddModal()"
          ></button>
          <button
            pButton
            pRipple
            [label]="Delete"
            icon="pi pi-trash"
            class="p-button-danger"
            (click)="deleteItems()"
            [disabled]="!selectedItems || !selectedItems.length"
          ></button>
        </ng-template>

        <ng-template pTemplate="right">
          <span class="p-input-icon-left">
            <i class="pi pi-search"></i>
            <input
              pInputText
              type="text"
              (keyup.enter)="loadData()"
              [(ngModel)]="keyword"
              placeholder="Nhập tên vai trò..."
            />
          </span>
        </ng-template>
      </p-toolbar>

      <p-table
        #dt
        [value]="items"
        [rows]="10"
        [paginator]="false"
        [globalFilterFields]="['name']"
        [(selection)]="selectedItems"
        [rowHover]="true"
        dataKey="id"
      >
        <ng-template pTemplate="header">
          <tr>
            <th style="width: 3rem">
              <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
            </th>
            <th pSortableColumn="name">Tên <p-sortIcon field="name"></p-sortIcon></th>
            <th pSortableColumn="isPublic">Công khai</th>
            <th pSortableColumn="isDefault">Mặc định</th>
            <th pSortableColumn="rating">Reviews</th>
            <th>Thao tác</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-row>
          <tr>
            <td>
              <p-tableCheckbox [value]="row"></p-tableCheckbox>
            </td>
            <td>{{ row.name }}</td>
            <td>
              <p-tag
                styleClass="mr-2"
                [severity]="row.isPublic == true ? 'info' : 'warning'"
                [value]="row.isPublic"
              >
              </p-tag>
            </td>
            <td>
              <p-tag
                styleClass="mr-2"
                [severity]="row.isDefault == true ? 'info' : 'warning'"
                [value]="row.isDefault"
              >
              </p-tag>
            </td>
            <td>{{ row.description }}</td>
            <td>
              <button
                pButton
                pRipple
                icon="pi pi-pencil"
                class="p-button-rounded p-button-success mr-2"
                (click)="showEditModal(row)"
              ></button>
              <button
                pButton
                pRipple
                icon="pi pi-wrench"
                class="p-button-rounded p-button-info mr-2"
                (click)="showPermissionModal(row.id, row.name)"
              ></button>
              
              <button
                pButton
                pRipple
                icon="pi pi-trash"
                class="p-button-rounded p-button-warning"
                (click)="deleteRow(row)"
              ></button>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="summary">
          <div class="p-d-flex p-ai-center p-jc-between">Tổng số: {{ totalCount | number }}</div>
          <p-paginator
            [rows]="maxResultCount"
            [totalRecords]="totalCount"
            (onPageChange)="pageChanged($event)"
            [rowsPerPageOptions]="[10, 20, 50, 100]"
          ></p-paginator>
        </ng-template>
      </p-table>
    </div>

    <p-blockUI [target]="pnl" [blocked]="blockedPanel">
      <p-progressSpinner
        [style]="{ width: '100px', height: '100px', position: 'absolute', top: '25%', left: '50%' }"
        strokeWidth="2"
        animationDuration=".5s"
      ></p-progressSpinner>
    </p-blockUI>
  </p-panel>
</div>
